# UTM Analytics Standard - AssetCare24

**–í–µ—Ä—Å–∏—è:** 3.0 (MVP Simplified)
**–î–∞—Ç–∞:** 14 —è–Ω–≤–∞—Ä—è 2026 –≥.
**–ê–≤—Ç–æ—Ä:** AI Assistant
**–ò–∑–º–µ–Ω–µ–Ω–∏—è:** –£–ø—Ä–æ—â–µ–Ω–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–ª—è MVP —Å –Ω–∞–¥–µ–∂–Ω—ã–º–∏ —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—è–º–∏ `||-` –∏ `-||`

## üéØ –û–±–∑–æ—Ä

–≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –µ–¥–∏–Ω—ã–π —Å—Ç–∞–Ω–¥–∞—Ä—Ç UTM-–º–µ—Ç–æ–∫ –¥–ª—è AssetCare24, –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ–¥ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è WhatsApp. –ü–æ—Å–∫–æ–ª—å–∫—É WhatsApp –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç URL-–ø–∞—Ä–∞–º–µ—Ç—Ä—ã, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ñ–æ—Ä–º–∞—Ç —Å –∫–æ–¥–∞–º–∏ –≤ –ø—Ä–µ–¥–∑–∞–ø–æ–ª–Ω–µ–Ω–Ω–æ–º —Ç–µ–∫—Å—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–π.

**–ö–ª—é—á–µ–≤—ã–µ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- –ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω—É—é –∞–Ω–∞–ª–∏—Ç–∏–∫—É –≤—Å–µ—Ö —Ç–æ—á–µ–∫ –≤—Ö–æ–¥–∞
- –ü—Ä–æ—Å—Ç—É—é –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—é –∑–∞—è–≤–æ–∫ –≤ n8n
- –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å –¥–ª—è –±—É–¥—É—â–∏—Ö —Ç–∏–ø–æ–≤ –∫–ª–∏–µ–Ω—Ç–æ–≤ –∏ –º–∞—Å—Ç–µ—Ä–æ–≤
- –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å WhatsApp Click-to-Chat

---

## üìä –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–æ–¥–æ–≤ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ (MVP Simplified)

### –ë–∞–∑–æ–≤—ã–π —Ñ–æ—Ä–º–∞—Ç –∫–æ–¥–∞
```
||-R-{SOURCE}-{USER_TYPE}-{CLIENT_TYPE}-{CODE}-||
```

**–ü—Ä–∏–º–µ—Ä—ã:**
- `||-R-QR-C-C-00001-||` ‚Äî –ö–æ–Ω—Ç—Ä–∞–∫—Ç–Ω—ã–π –∫–ª–∏–µ–Ω—Ç —á–µ—Ä–µ–∑ QR-–∫–æ–¥
- `||-R-QR-M-C-00001-||` ‚Äî **–†–∞–±–æ—Ç–Ω–∏–∫, –æ–±—Å–ª—É–∂–∏–≤–∞—é—â–∏–π –∫–æ–Ω—Ç—Ä–∞–∫—Ç 00001**
- `||-R-WB-M-0-00000-||` ‚Äî –ú–∞—Å—Ç–µ—Ä —á–µ—Ä–µ–∑ –≤–µ–±-—Å–∞–π—Ç

**–ì–¥–µ:**
- `||-` ‚Äî –ø—Ä–µ—Ñ–∏–∫—Å –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞ (—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π)
- `R` ‚Äî –ø–∞—Ä–∞–º–µ—Ç—Ä –¥–µ–π—Å—Ç–≤–∏—è: "—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è" (—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π)
- `{SOURCE}` ‚Äî –∏—Å—Ç–æ—á–Ω–∏–∫: `WB` (—Å–∞–π—Ç) –∏–ª–∏ `QR` (QR-–∫–æ–¥—ã)
- `{USER_TYPE}` ‚Äî —Ç–∏–ø –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: `C` (–∫–ª–∏–µ–Ω—Ç) –∏–ª–∏ `M` (–º–∞—Å—Ç–µ—Ä)
- `{CLIENT_TYPE}` ‚Äî —Ç–∏–ø –∫–ª–∏–µ–Ω—Ç–∞: `C` (–∫–æ–Ω—Ç—Ä–∞–∫—Ç–Ω—ã–π) –∏–ª–∏ `P` (–ø—É–±–ª–∏—á–Ω—ã–π), –¥–ª—è –º–∞—Å—Ç–µ—Ä–æ–≤ = `0`
- `{CODE}` ‚Äî 5-—Ç–∏ –∑–Ω–∞—á–Ω—ã–π –∫–æ–¥ (00000 –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
- `-||` ‚Äî —Å—É—Ñ—Ñ–∏–∫—Å –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞ (—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π)

### –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤

#### {SOURCE} (–ò—Å—Ç–æ—á–Ω–∏–∫ —Ç—Ä–∞—Ñ–∏–∫–∞)
- **WB** - –í–µ–±-—Å–∞–π—Ç AssetCare24
- **QR** - QR-–∫–æ–¥—ã –Ω–∞ –æ–±—ä–µ–∫—Ç–∞—Ö

#### {USER_TYPE} (–¢–∏–ø –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)
- **C** - –ö–ª–∏–µ–Ω—Ç (–∑–∞—è–≤–∫–∏ –Ω–∞ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ)
- **M** - –ú–∞—Å—Ç–µ—Ä (—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è)

#### {CLIENT_TYPE} (–¢–∏–ø –∫–ª–∏–µ–Ω—Ç–∞ –ø–æ –¥–æ–≥–æ–≤–æ—Ä—É)
- **C** - –ö–æ–Ω—Ç—Ä–∞–∫—Ç–Ω—ã–π –∫–ª–∏–µ–Ω—Ç (—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –¥–æ–≥–æ–≤–æ—Ä–Ω—ã–µ –æ—Ç–Ω–æ—à–µ–Ω–∏—è)
- **P** - –ü—É–±–ª–∏—á–Ω—ã–π –∫–ª–∏–µ–Ω—Ç (–Ω–æ–≤—ã–µ –∫–ª–∏–µ–Ω—Ç—ã –±–µ–∑ –¥–æ–≥–æ–≤–æ—Ä–∞)
- **0** - –î–ª—è –º–∞—Å—Ç–µ—Ä–æ–≤ (–Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)

#### {CODE} (5-—Ç–∏ –∑–Ω–∞—á–Ω—ã–π –∫–æ–¥)
- **00000** - –ó–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
- **00001-99999** - –°–ø–µ—Ü–∏—Ñ–∏—á–µ—Å–∫–∏–µ –∫–æ–¥—ã:
  - –ù–æ–º–µ—Ä –∫–æ–Ω—Ç—Ä–∞–∫—Ç–Ω–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞
  - –ù–æ–º–µ—Ä —Ä–µ–∫–ª–∞–º–Ω–æ–π –∫–∞–º–ø–∞–Ω–∏–∏
  - ID –æ–±—ä–µ–∫—Ç–∞/–∑–¥–∞–Ω–∏—è
  - –î—Ä—É–≥–∏–µ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã

---

## üîÑ –ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è –∑–∞—è–≤–æ–∫ (n8n)

### –õ–æ–≥–∏–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ –∫–æ–¥–∞ –∏—Å—Ç–æ—á–Ω–∏–∫–∞

#### 1. –†–µ–≥—É–ª—è—Ä–Ω–æ–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞
```javascript
// –§—É–Ω–∫—Ü–∏—è –ø–∞—Ä—Å–∏–Ω–≥–∞ R-–∫–æ–¥–∞ (—É–ø—Ä–æ—â–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è –¥–ª—è MVP)
function parseSourceCode(message) {
  const regex = /\|\|-R-([A-Z]{2})-([CM])-([CP0])-(\d{5})-\|\|/;
  const match = message.match(regex);

  if (!match) return null;

  return {
    source: match[1],      // 'WB' (—Å–∞–π—Ç) –∏–ª–∏ 'QR' (QR-–∫–æ–¥)
    userType: match[2],    // 'C' (–∫–ª–∏–µ–Ω—Ç) –∏–ª–∏ 'M' (–º–∞—Å—Ç–µ—Ä)
    clientType: match[3],  // 'C' (–∫–æ–Ω—Ç—Ä–∞–∫—Ç–Ω—ã–π), 'P' (–ø—É–±–ª–∏—á–Ω—ã–π) –∏–ª–∏ '0' (–¥–ª—è –º–∞—Å—Ç–µ—Ä–æ–≤)
    code: match[4]         // '00000' –∏–ª–∏ —Å–ø–µ—Ü–∏—Ñ–∏—á–µ—Å–∫–∏–π 5-—Ç–∏ –∑–Ω–∞—á–Ω—ã–π –∫–æ–¥
  };
}
```

#### 2. –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∏–ø–∞ –∑–∞–ø—Ä–æ—Å–∞
```javascript
function classifyRequest(parsedCode) {
  if (!parsedCode) return 'unknown';

  if (parsedCode.userType === 'C') {
    // –ö–ª–∏–µ–Ω—Ç—Å–∫–∞—è –∑–∞—è–≤–∫–∞
    return {
      requestType: 'client_request',
      source: parsedCode.source === 'WB' ? 'website' : 'qr_code',
      clientCategory: parsedCode.clientType === 'C' ? 'contract' : 'public',
      clientCode: parsedCode.code,
      isContractClient: parsedCode.clientType === 'C'
    };
  } else if (parsedCode.userType === 'M') {
    // –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –º–∞—Å—Ç–µ—Ä–∞
    return {
      requestType: 'master_registration',
      source: parsedCode.source === 'WB' ? 'website' : 'qr_code',
      masterCode: parsedCode.code
    };
  }

  return 'unknown';
}
```

#### 3. Fallback –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –∫–æ–¥–∞
```javascript
function handleNoCodeFallback(message) {
  // –ï—Å–ª–∏ –∫–æ–¥ –Ω–µ –Ω–∞–π–¥–µ–Ω, –ø—Ä–µ–¥–ª–∞–≥–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é —É—Ç–æ—á–Ω–∏—Ç—å –∏—Å—Ç–æ—á–Ω–∏–∫
  const fallbackOptions = [
    { text: '–ß–µ—Ä–µ–∑ QR-–∫–æ–¥', value: 'qr_code' },
    { text: '–ß–µ—Ä–µ–∑ –Ω–∞—à —Å–∞–π—Ç', value: 'website' },
    { text: '–ß–µ—Ä–µ–∑ —Ä–µ–∫–ª–∞–º—É', value: 'advertisement' },
    { text: '–ü–æ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏', value: 'referral' }
  ];

  return {
    hasCode: false,
    fallbackOptions: fallbackOptions,
    suggestedResponse: '–ù–µ —Å–º–æ–≥–ª–∏ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –∏—Å—Ç–æ—á–Ω–∏–∫. –£—Ç–æ—á–Ω–∏—Ç–µ, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, –∫–∞–∫ –≤—ã —É–∑–Ω–∞–ª–∏ –æ –Ω–∞—Å?'
  };
}
```

---

## üìã –ü—Ä–∏–º–µ—Ä—ã –∫–æ–¥–æ–≤ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ (MVP Simplified)

### –¢–µ–∫—É—â–∏–µ —Ç–æ—á–∫–∏ –≤—Ö–æ–¥–∞ (MVP v3.0)

#### –ö–ª–∏–µ–Ω—Ç—Å–∫–∏–µ –∑–∞—è–≤–∫–∏:
```
# –ö–æ–Ω—Ç—Ä–∞–∫—Ç–Ω—ã–π –∫–ª–∏–µ–Ω—Ç —á–µ—Ä–µ–∑ QR-–∫–æ–¥ (–∫–æ–¥ –∫–ª–∏–µ–Ω—Ç–∞ 00001)
||-R-QR-C-C-00001-||

# –ü—É–±–ª–∏—á–Ω—ã–π –∫–ª–∏–µ–Ω—Ç —á–µ—Ä–µ–∑ QR-–∫–æ–¥ (–±–µ–∑ —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ–≥–æ –∫–æ–¥–∞)
||-R-QR-C-P-00000-||

# –ö–æ–Ω—Ç—Ä–∞–∫—Ç–Ω—ã–π –∫–ª–∏–µ–Ω—Ç —á–µ—Ä–µ–∑ —Å–∞–π—Ç (–∫–æ–Ω—Ç—Ä–∞–∫—Ç ‚Ññ123)
||-R-WB-C-C-00123-||

# –ü—É–±–ª–∏—á–Ω—ã–π –∫–ª–∏–µ–Ω—Ç —á–µ—Ä–µ–∑ —Å–∞–π—Ç (—Ä–µ–∫–ª–∞–º–Ω–∞—è –∫–∞–º–ø–∞–Ω–∏—è ‚Ññ5)
||-R-WB-C-P-00005-||
```

#### –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –º–∞—Å—Ç–µ—Ä–æ–≤:
```
# –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –º–∞—Å—Ç–µ—Ä–∞ —á–µ—Ä–µ–∑ —Å–∞–π—Ç (–∫–æ–¥ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ 00001)
||-R-WB-M-0-00001-||

# –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –º–∞—Å—Ç–µ—Ä–∞ —á–µ—Ä–µ–∑ QR-–∫–æ–¥ (—Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–π –∫–æ–¥ 00234)
||-R-QR-M-0-00234-||
```

### –ü–æ–ª–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã WhatsApp —Å–æ–æ–±—â–µ–Ω–∏–π:

#### –ö–ª–∏–µ–Ω—Ç—Å–∫–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è:
```
Hallo, ich brauche Hilfe bei der Reparatur
–ö–æ–¥ –∏—Å—Ç–æ—á–Ω–∏–∫–∞: ||-R-QR-C-C-00001-||

Bitte helfen Sie mir mit der Reparatur
–ö–æ–¥ –∏—Å—Ç–æ—á–Ω–∏–∫–∞: ||-R-WB-C-P-00005-||
```

#### –ú–∞—Å—Ç–µ—Ä—Å–∫–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è:
```
Hallo, ich m√∂chte mich als Handwerker registrieren
–ö–æ–¥ –∏—Å—Ç–æ—á–Ω–∏–∫–∞: ||-R-WB-M-0-00001-||

Ich interessiere mich f√ºr Handwerksarbeiten
–ö–æ–¥ –∏—Å—Ç–æ—á–Ω–∏–∫–∞: ||-R-QR-M-0-00234-||

Ich bin Techniker f√ºr Vertrag 00001
–ö–æ–¥ –∏—Å—Ç–æ—á–Ω–∏–∫–∞: ||-R-QR-M-C-00001-||
```

---

## üõ†Ô∏è –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

### –í–µ–±-—Å–∞–π—Ç (Next.js)

#### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ WhatsApp —Å—Å—ã–ª–æ–∫:
```typescript
interface SourceCodeParams {
  source: 'WB' | 'QR';           // –¢–æ–ª—å–∫–æ 2 –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –¥–ª—è MVP
  userType: 'C' | 'M';           // –ö–ª–∏–µ–Ω—Ç –∏–ª–∏ –º–∞—Å—Ç–µ—Ä
  clientType: 'C' | 'P' | '0';   // –¢–∏–ø –∫–ª–∏–µ–Ω—Ç–∞ (0 –¥–ª—è –º–∞—Å—Ç–µ—Ä–æ–≤)
  code: string;                  // 5-—Ç–∏ –∑–Ω–∞—á–Ω—ã–π –∫–æ–¥ (00000 –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
}

function generateSourceCode(params: SourceCodeParams): string {
  return `||-R-${params.source}-${params.userType}-${params.clientType}-${params.code.padStart(5, '0')}-||`;
}

function generateWhatsAppLink(phone: string, baseMessage: string, params: SourceCodeParams): string {
  const sourceCode = generateSourceCode(params);
  const fullMessage = `${baseMessage}\n\n–ö–æ–¥ –∏—Å—Ç–æ—á–Ω–∏–∫–∞: ${sourceCode}`;

  return `https://wa.me/${phone}?text=${encodeURIComponent(fullMessage)}`;
}

// –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

// –ö–æ–Ω—Ç—Ä–∞–∫—Ç–Ω—ã–π –∫–ª–∏–µ–Ω—Ç —á–µ—Ä–µ–∑ QR-–∫–æ–¥
const contractClientLink = generateWhatsAppLink(
  '491234567890',
  'Hallo, ich brauche Hilfe bei der Reparatur',
  {
    source: 'QR',
    userType: 'C',
    clientType: 'C',
    code: '00001'  // –ù–æ–º–µ—Ä –∫–æ–Ω—Ç—Ä–∞–∫—Ç–Ω–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞
  }
);
// –†–µ–∑—É–ª—å—Ç–∞—Ç: https://wa.me/491234567890?text=Hallo%2C%20ich%20brauche%20Hilfe%20bei%20der%20Reparatur%0A%0A%D0%9A%D0%BE%D0%B4%20%D0%B8%D1%81%D1%82%D0%BE%D1%87%D0%BD%D0%B8%D0%BA%D0%B0%3A%20%7C%7C-R-QR-C-C-00001-%7C%7C

// –ú–∞—Å—Ç–µ—Ä —á–µ—Ä–µ–∑ —Å–∞–π—Ç
const masterLink = generateWhatsAppLink(
  '491234567890',
  'Hallo, ich m√∂chte mich als Handwerker registrieren',
  {
    source: 'WB',
    userType: 'M',
    clientType: '0',
    code: '00001'  // –ö–æ–¥ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
  }
);
// –†–µ–∑—É–ª—å—Ç–∞—Ç: https://wa.me/491234567890?text=Hallo%2C%20ich%20m%C3%B6chte%20mich%20als%20Handwerker%20registrieren%0A%0A%D0%9A%D0%BE%D0%B4%20%D0%B8%D1%81%D1%82%D0%BE%D1%87%D0%BD%D0%B8%D0%BA%D0%B0%3A%20%7C%7C-R-WB-M-0-00001-%7C%7C
```

### n8n Workflow

#### –ü—Ä–æ—Å—Ç–æ–π –ø–∞—Ä—Å–∏–Ω–≥ —Å–æ–æ–±—â–µ–Ω–∏—è:
```javascript
// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞ —É–ø—Ä–æ—â–µ–Ω–Ω–æ–≥–æ R-–∫–æ–¥–∞
function parseWhatsAppMessage(message) {
  // –ò—â–µ–º –∫–æ–¥ –º–µ–∂–¥—É —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—è–º–∏ ||- –∏ -||
  const regex = /\|\|-R-([A-Z]{2})-([CM])-([CP0])-(\d{5})-\|\|/;
  const match = message.match(regex);

  if (!match) {
    return {
      hasValidCode: false,
      requestType: 'unknown',
      fallback: true
    };
  }

  const parsedCode = {
    source: match[1],      // 'WB' –∏–ª–∏ 'QR'
    userType: match[2],    // 'C' –∏–ª–∏ 'M'
    clientType: match[3],  // 'C', 'P' –∏–ª–∏ '0'
    code: match[4]         // '00000' –∏–ª–∏ —Å–ø–µ—Ü–∏—Ñ–∏—á–µ—Å–∫–∏–π –∫–æ–¥
  };

  // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–∏–ø –∑–∞–ø—Ä–æ—Å–∞
  let requestType = 'unknown';
  if (parsedCode.userType === 'C') {
    requestType = 'client_request';
  } else if (parsedCode.userType === 'M') {
    requestType = 'master_registration';
  }

  return {
    hasValidCode: true,
    requestType: requestType,
    source: parsedCode.source === 'WB' ? 'website' : 'qr_code',
    userType: parsedCode.userType === 'C' ? 'client' : 'master',
    clientCategory: parsedCode.clientType === 'C' ? 'contract' : 'public',
    clientCode: parsedCode.code,
    originalCode: match[0]
  };
}

// –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
const message = "Hallo, ich brauche Hilfe\n–ö–æ–¥ –∏—Å—Ç–æ—á–Ω–∏–∫–∞: ||-R-QR-C-C-00001-||";
const result = parseWhatsAppMessage(message);
// –†–µ–∑—É–ª—å—Ç–∞—Ç:
// {
//   hasValidCode: true,
//   requestType: 'client_request',
//   source: 'qr_code',
//   userType: 'client',
//   clientCategory: 'contract',
//   clientCode: '00001',
//   originalCode: '||-R-QR-C-C-00001-||'
// }
```

---

## üìà –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –∏ –æ—Ç—á–µ—Ç–Ω–æ—Å—Ç—å

### –ú–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è

#### –ö–æ–Ω–≤–µ—Ä—Å–∏–æ–Ω–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏:
- **CTR (Click-through rate)** - –ø—Ä–æ—Ü–µ–Ω—Ç –∫–ª–∏–∫–æ–≤ –ø–æ WhatsApp —Å—Å—ã–ª–∫–∞–º
- **Conversion rate** - –ø—Ä–æ—Ü–µ–Ω—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã—Ö –∑–∞—è–≤–æ–∫ –æ—Ç –∫–ª–∏–∫–æ–≤
- **Customer acquisition cost** - —Å—Ç–æ–∏–º–æ—Å—Ç—å –ø—Ä–∏–≤–ª–µ—á–µ–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–∞ –ø–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º
- **Channel efficiency** - —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∫–∞–Ω–∞–ª–æ–≤ (–∑–∞—Ç—Ä–∞—Ç—ã/–∑–∞—è–≤–∫–∞)
- **Source attribution accuracy** - —Ç–æ—á–Ω–æ—Å—Ç—å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∏—Å—Ç–æ—á–Ω–∏–∫–∞ —Ç—Ä–∞—Ñ–∏–∫–∞

#### –ò—Å—Ç–æ—á–Ω–∏–∫–∏ —Ç—Ä–∞—Ñ–∏–∫–∞:
- **Source performance** - –∫–æ–Ω–≤–µ—Ä—Å–∏–∏ –ø–æ –∫–∞–∂–¥–æ–º—É –∏—Å—Ç–æ—á–Ω–∏–∫—É (WEB, IG, QR, etc.)
- **Campaign ROI** - –æ–∫—É–ø–∞–µ–º–æ—Å—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –∫–∞–º–ø–∞–Ω–∏–π
- **Channel attribution** - –≤–∫–ª–∞–¥ –∫–∞–∂–¥–æ–≥–æ –∫–∞–Ω–∞–ª–∞ –≤ –æ–±—â–∏–π —Ç—Ä–∞—Ñ–∏–∫
- **Code integrity** - –ø—Ä–æ—Ü–µ–Ω—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –ø–µ—Ä–µ–¥–∞–Ω–Ω—ã—Ö –∫–æ–¥–æ–≤ –∏—Å—Ç–æ—á–Ω–∏–∫–∞

### Google Analytics 4

#### –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ —Å–æ–±—ã—Ç–∏—è:
```javascript
// –ö–ª–∏–∫ –ø–æ WhatsApp —Å—Å—ã–ª–∫–µ (–Ω–∞ —Å–∞–π—Ç–µ)
gtag('event', 'click', {
  event_category: 'whatsapp',
  event_label: 'contact_button',
  custom_parameter_source: 'WEB',  // –ò—Å—Ç–æ—á–Ω–∏–∫
  custom_parameter_campaign: 'MAIN' // –ö–∞–º–ø–∞–Ω–∏—è
});

// –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ n8n
gtag('event', 'whatsapp_message_received', {
  source: parsedData.source,      // 'WEB', 'IG', 'QR'
  campaign: parsedData.campaign,  // 'MAIN', 'SERV', 'QRCO'
  has_valid_code: parsedData.hasValidCode,
  contract_id: parsedData.additionalParams.contract || null
});

// –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞—è–≤–∫–∏
gtag('event', 'request_created', {
  source: parsedData.source,
  campaign: parsedData.campaign,
  request_type: 'client_request', // –∏–ª–∏ 'master_registration'
  contract_id: parsedData.additionalParams.contract || null,
  building_id: parsedData.additionalParams.building || null
});

// –ö–æ–Ω—Ç—Ä–∞–∫—Ç–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏
gtag('event', 'contract_interaction', {
  contract_id: parsedData.additionalParams.contract,
  interaction_type: parsedData.campaign,
  source: parsedData.source,
  building: parsedData.additionalParams.building
});
```

### –û—Ç—á–µ—Ç—ã –≤ Supabase

#### SQL –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤:
```sql
-- –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ —Ç—Ä–∞—Ñ–∏–∫–∞
SELECT
  source,
  campaign,
  COUNT(*) as total_requests,
  COUNT(CASE WHEN status = 'completed' THEN 1 END) as completed_requests,
  ROUND(
    COUNT(CASE WHEN status = 'completed' THEN 1 END)::numeric /
    COUNT(*)::numeric * 100, 2
  ) as completion_rate
FROM requests r
JOIN clients c ON r.client_id = c.id
WHERE c.source IS NOT NULL
GROUP BY source, campaign
ORDER BY total_requests DESC;

-- –ê–Ω–∞–ª–∏–∑ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤
SELECT
  contract_id,
  COUNT(*) as requests_count,
  AVG(CASE WHEN status = 'completed' THEN 1 ELSE 0 END) as completion_rate,
  MAX(created_at) as last_request_date
FROM (
  SELECT
    (meta_data->>'contract_id') as contract_id,
    status,
    created_at
  FROM requests r
  JOIN clients c ON r.client_id = c.id
  WHERE c.meta_data->>'contract_id' IS NOT NULL
) contract_requests
GROUP BY contract_id
ORDER BY requests_count DESC;
```

---

## üöÄ –í–Ω–µ–¥—Ä–µ–Ω–∏–µ –≤ —Å–∞–π—Ç (Next.js)

### 1. –°–æ–∑–¥–∞–Ω–∏–µ —É—Ç–∏–ª–∏—Ç—ã –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–æ–¥–æ–≤

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `lib/source-codes.ts`:

```typescript
export interface SourceCodeParams {
  source: 'WEB' | 'IG' | 'FB' | 'TT' | 'GG' | 'QR' | 'OR' | 'LI' | 'YT' | 'EM' | 'RF';
  campaign: 'MAIN' | 'SERV' | 'LAND' | 'QRCO' | 'QRPU' | 'SOCO' | 'ADGO' | 'ADFB' | 'ADIG' | 'ADTT' | 'MREG' | 'MREF' | 'TPOR' | 'ODSH' | 'MAPI';
  additionalParams?: {
    contract?: string;
    building?: string;
    tenant?: string;
    company?: string;
  };
}

export function generateSourceCode(params: SourceCodeParams): string {
  const date = new Date().toISOString().slice(0, 10).replace(/-/g, '');
  const nonce = Math.random().toString(36).substr(2, 4).toUpperCase();

  return `SRC-${params.source}-${params.campaign}-${date}-${nonce}`;
}

export function generateWhatsAppLink(
  phone: string,
  baseMessage: string,
  params: SourceCodeParams
): string {
  const sourceCode = generateSourceCode(params);

  let additionalText = '';
  if (params.additionalParams) {
    if (params.additionalParams.contract) {
      additionalText += ` [CONTRACT:${params.additionalParams.contract}]`;
    }
    if (params.additionalParams.building) {
      additionalText += ` [BUILDING:${params.additionalParams.building}]`;
    }
    if (params.additionalParams.tenant) {
      additionalText += ` [TENANT:${params.additionalParams.tenant}]`;
    }
    if (params.additionalParams.company) {
      additionalText += ` [COMPANY:${params.additionalParams.company}]`;
    }
  }

  const fullMessage = `${baseMessage}\n\n–ö–æ–¥ –∏—Å—Ç–æ—á–Ω–∏–∫–∞: ${sourceCode}${additionalText}`;

  return `https://wa.me/${phone}?text=${encodeURIComponent(fullMessage)}`;
}
```

### 2. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

–ü—Ä–∏–º–µ—Ä –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–Ω–æ–ø–∫–∏ –Ω–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ:

```tsx
// components/hero-section.tsx
import { generateWhatsAppLink } from '@/lib/source-codes';

export function HeroSection() {
  const whatsappLink = generateWhatsAppLink(
    '491234567890', // –í–∞—à WhatsApp –Ω–æ–º–µ—Ä
    'Hallo, ich brauche Hilfe bei der Reparatur',
    {
      source: 'WEB',
      campaign: 'MAIN'
    }
  );

  return (
    <a
      href={whatsappLink}
      className="bg-green-500 text-white px-8 py-4 rounded-lg font-semibold hover:bg-green-600 transition-colors"
      onClick={() => {
        // GA4 —Å–æ–±—ã—Ç–∏–µ
        gtag('event', 'click', {
          event_category: 'whatsapp',
          event_label: 'hero_button',
          custom_parameter_source: 'WEB',
          custom_parameter_campaign: 'MAIN'
        });
      }}
    >
      WhatsApp Nachricht senden
    </a>
  );
}
```

### 3. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

#### –ü—Ä–æ–≤–µ—Ä–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å—Å—ã–ª–æ–∫:
```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∞–π—Ç –∏ –ø–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ utm-test —Å—Ç—Ä–∞–Ω–∏—Ü—É
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏—é —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Ç–∏–ø–æ–≤ —Å—Å—ã–ª–æ–∫
curl "http://localhost:3000/utm-test"
```

#### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ –≤ n8n:
```javascript
// –¢–µ—Å—Ç–æ–≤—ã–π –∫–æ–¥ –¥–ª—è n8n
const testMessage = "Hallo, ich brauche Hilfe bei der Reparatur\n\n–ö–æ–¥ –∏—Å—Ç–æ—á–Ω–∏–∫–∞: SRC-WEB-MAIN-20260114-AB3F [CONTRACT:001]";

const parsed = parseWhatsAppMessage(testMessage);
console.log(parsed);
// –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:
// {
//   sourceCode: "SRC-WEB-MAIN-20260114-AB3F",
//   source: "WEB",
//   campaign: "MAIN",
//   date: "20260114",
//   nonce: "AB3F",
//   additionalParams: { contract: "001" },
//   hasValidCode: true
// }
```

---

## üîÆ –ü–ª–∞–Ω—ã —Ä–∞–∑–≤–∏—Ç–∏—è

### –§–∞–∑–∞ 2: –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏ (Q2 2026)

#### –ù–æ–≤—ã–µ —Ç–∏–ø—ã –∫–ª–∏–µ–Ω—Ç–æ–≤:
- **Tenants (—Å—ä–µ–º—â–∏–∫–∏)** - —á–µ—Ä–µ–∑ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ—Ä—Ç–∞–ª –∞—Ä–µ–Ω–¥–∞—Ç–æ—Ä–æ–≤
- **Property Owners (—Å–æ–±—Å—Ç–≤–µ–Ω–Ω–∏–∫–∏)** - —á–µ—Ä–µ–∑ –ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–∏–∫–∞
- **Property Managers (—É–ø—Ä–∞–≤–ª—è—é—â–∏–µ)** - —á–µ—Ä–µ–∑ API –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é

#### –ù–æ–≤—ã–µ —Ç–∏–ø—ã –º–∞—Å—Ç–µ—Ä–æ–≤ (Q3 2026):
- **Freelancers (—Ñ—Ä–∏–ª–∞–Ω—Å–µ—Ä—ã)** - –º–∞—Å—Ç–µ—Ä–∞, –ø–æ–¥—Ä–∞–±–∞—Ç—ã–≤–∞—é—â–∏–µ –Ω–µ–ø–æ–ª–Ω—ã–π –¥–µ–Ω—å
- **Companies (–∫–æ–º–ø–∞–Ω–∏–∏)** - –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ —Å —à—Ç–∞—Ç–Ω—ã–º–∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º–∏

### –§–∞–∑–∞ 3: AI-–º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è (Q4 2026)

#### –ò–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω–∞—è –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è:
- –ê–Ω–∞–ª–∏–∑ –∏—Å—Ç–æ—Ä–∏–∏ –∫–ª–∏–µ–Ω—Ç–∞ –¥–ª—è –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏–∏
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å—Ä–æ—á–Ω–æ—Å—Ç–∏ –∑–∞—è–≤–∫–∏
- –ü—Ä–µ–¥–∏–∫—Ç–∏–≤–Ω–æ–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ –º–∞—Å—Ç–µ—Ä–æ–≤
- –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Å—Ç–æ–∏–º–æ—Å—Ç–∏ —É—Å–ª—É–≥

---

## üìû –ö–æ–Ω—Ç–∞–∫—Ç—ã

**–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å:** Artem Tihonov
**–ê–Ω–∞–ª–∏—Ç–∏–∫–∞:** AI Assistant
**–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:** `mvp/utm_analytics_standard.md`

---

## ‚úÖ –ö–ª—é—á–µ–≤—ã–µ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ —É–ø—Ä–æ—â–µ–Ω–Ω–æ–≥–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞

1. **MVP-–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è** - —Ç–æ–ª—å–∫–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è –∑–∞–ø—É—Å–∫–∞
2. **–ù–∞–¥–µ–∂–Ω—ã–µ —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª–∏** - `||-` –∏ `-||` –æ–±–µ—Å–ø–µ—á–∏–≤–∞—é—Ç —Ç–æ—á–Ω–æ–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ
3. **–ü—Ä–æ—Å—Ç–æ—Ç–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞** - –æ–¥–Ω–∞ —Ä–µ–≥—É–ª—è—Ä–∫–∞ –¥–ª—è –≤—Å–µ—Ö —Å–ª—É—á–∞–µ–≤
4. **–û—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å** - –ª–µ–≥–∫–æ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ/–æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∫–æ–¥–∞
5. **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å** - –ª–µ–≥–∫–æ —Ä–∞—Å—à–∏—Ä–∏—Ç—å –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
6. **–ß–∏—Ç–∞–µ–º–æ—Å—Ç—å** - –∫–æ–¥ –ª–µ–≥–∫–æ –ø–æ–Ω—è—Ç—å –∏ –æ—Ç–¥–µ–±–∞–∂–∏—Ç—å

**–≠—Ç–æ—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç –∏–¥–µ–∞–ª–µ–Ω –¥–ª—è MVP: –ø—Ä–æ—Å—Ç–æ—Ç–∞ + –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å + –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è.**</contents>
</xai:function_call<parameter name="write">
<parameter name="file_path">/home/aaa/Projects/n8n/assetcare24/mvp/utm_analytics_standard.md
